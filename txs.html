<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WAST Analyzer 8.2 (Deep Indexing)</title>
    
    <script type="module">
        import { sdk } from 'https://esm.sh/@farcaster/miniapp-sdk';
        const run = async () => { await sdk.actions.ready(); };
        run();
    </script>

    <style>
        :root { --primary: #0052FF; --bg: #f5f5f7; --card-bg: #ffffff; --text: #1a1a1a; --green: #2ecc71; --red: #ff4757; --orange: #ff9f43; --purple: #9c27b0; --dark: #34495e; --pink: #d63384; --cyan: #00bcd4; --indigo: #3f51b5; }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            background-color: var(--bg);
            background-image: url('back.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            color: var(--text); 
            padding: 15px; 
            margin: 0; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            overflow-x: hidden; 
        }
        
        .nav-header { width: 100%; max-width: 600px; display: flex; margin-bottom: 20px; justify-content: space-between; align-items: center;}
        .back-btn { text-decoration: none; color: #666; font-weight: 600; background: white; padding: 8px 15px; border-radius: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); font-size: 0.9rem; }
        .wast-mini { font-weight: 900; font-size: 1rem; letter-spacing: 2px; color: var(--primary); margin-left: 10px; }
        
        .container { background: var(--card-bg); padding: 20px; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.06); width: 100%; max-width: 600px; box-sizing: border-box; position: relative; }
        
        .input-group { margin-bottom: 15px; }
        label { display: flex; justify-content: space-between; align-items: center; font-weight: 600; font-size: 0.75rem; margin-bottom: 6px; color: #666; text-transform: uppercase; }
        
        .clear-link { color: white; background-color: var(--primary); padding: 4px 10px; border-radius: 6px; cursor: pointer; font-size: 0.75rem; text-decoration: none; font-weight: 700; box-shadow: 0 2px 5px rgba(0,82,255,0.2); transition: opacity 0.2s; }
        .clear-link:hover { opacity: 0.8; }

        input, select { width: 100%; padding: 12px; border: 2px solid #e1e4e8; border-radius: 12px; font-size: 14px; outline: none; background: #fafafa; box-sizing: border-box; font-family: inherit; }
        
        .loading-text { font-size: 0.8rem; color: #999; font-style: italic; margin-top: 5px; display: none; text-align: center; }

        .btn-group { display: flex; gap: 8px; margin-top: 15px; width: 100%; }
        button { flex: 1; border: none; padding: 12px; border-radius: 10px; font-weight: 700; font-size: 0.8rem; cursor: pointer; transition: opacity 0.2s; color: white; display: flex; align-items: center; justify-content: center; gap: 5px; }
        button:disabled { opacity: 0.6; cursor: not-allowed; }
        .btn-fast { background-color: var(--primary); }
        .btn-full { background-color: var(--dark); }
        .btn-hist { background-color: var(--purple); display: none; } 

        .dashboard-grid { display: grid; grid-template-columns: 1fr; gap: 15px; margin-top: 20px; margin-bottom: 10px; display: none; }
        .stat-card { background: #f8f9fa; padding: 15px; border-radius: 12px; border: 1px solid #eee; display: flex; flex-direction: column; }
        
        .stat-title { font-size: 0.75rem; text-transform: uppercase; font-weight: 900; margin-bottom: 10px; border-bottom: 2px solid #eee; padding-bottom: 6px; display: flex; justify-content: space-between; }
        .t-buy { color: var(--green); border-color: var(--green); }
        .t-sell { color: var(--red); border-color: var(--red); }
        .t-receive { color: var(--purple); border-color: var(--purple); }
        .t-send { color: var(--orange); border-color: var(--orange); }

        .stat-line { display: flex; justify-content: space-between; font-size: 0.9rem; margin-bottom: 5px; font-family: monospace; color: #444; }
        .stat-line strong { font-weight: 700; color: #000; }
        .val-hist { color: var(--purple); }
        .val-curr { color: #666; }

        table { width: 100%; border-collapse: collapse; font-size: 0.8rem; margin-top: 10px; table-layout: fixed; }
        th { text-align: left; color: #999; font-weight: 600; padding-bottom: 8px; border-bottom: 1px solid #eee; }
        td { padding: 10px 0; border-bottom: 1px solid #f0f0f0; vertical-align: middle; }
        .col-type { width: 40%; } .col-amount { width: 60%; text-align: right; }
        
        .tag { font-size: 0.6rem; padding: 3px 6px; border-radius: 4px; font-weight: 800; text-transform: uppercase; margin-right: 4px; display: inline-block; }
        .bg-buy { background: #e6fffa; color: var(--green); border: 1px solid #b2f5ea; }
        .bg-sell { background: #fff5f5; color: var(--red); border: 1px solid #fed7d7; }
        .bg-receive { background: #f3e5f5; color: var(--purple); border: 1px solid #e1bee7; }
        .bg-send { background: #fffaf0; color: var(--orange); border: 1px solid #feebc8; }
        
        .tx-sub { font-size: 0.7rem; color: #bbb; display: block; margin-top: 2px; }
        .tx-usd { font-size: 0.75rem; color: #999; font-weight: 500; display: block; margin-top: 2px; }
        
        #status { text-align: center; margin: 15px 0; font-weight: 600; font-size: 0.85rem; min-height: 20px; padding: 0 10px; }

        .wip-tag { text-align: center; font-size: 0.8rem; color: #ff4757; margin-top: 10px; font-weight: 900; letter-spacing: 1px; text-transform: uppercase; border: 1px dashed #ff4757; padding: 5px; border-radius: 8px; background: #fff5f5; }
        .version-tag { text-align: center; font-size: 0.7rem; color: #0052FF; margin-top: 25px; font-weight: 800; font-family: monospace; opacity: 0.8; }
    </style>
</head>
<body>

    <div class="nav-header">
        <a href="index.html" class="back-btn">‚¨Ö Home <span class="wast-mini">WAST</span></a>
    </div>

    <div class="container">
        <h2 style="text-align:center; margin-top:0;">Master Analyzer</h2>
        <p style="text-align:center; color:#666; font-size:0.8rem; margin-bottom:20px;">Logic: Deep Indexing & PnL</p>
        
        <div class="input-group">
            <label>Target Wallet <span id="btnChangeTarget" class="clear-link">Change üîÑ</span></label>
            <input type="text" id="walletInput" placeholder="0x..." />
        </div>

        <div class="input-group">
            <label>Token to Analyze <span id="toggleTokenMode" class="clear-link" style="background:#34495e;">Custom CA ‚úçÔ∏è</span></label>
            <div id="selectContainer"><select id="tokenSelect"><option value="" disabled selected>Waiting for wallet...</option></select><div id="loadingTokens" class="loading-text">Scanning...</div></div>
            <div id="inputContainer" style="display:none;"><input type="text" id="tokenInput" placeholder="Paste Token CA (0x...)" /></div>
        </div>

        <div class="btn-group">
            <button class="btn-fast" id="btnFast">‚ö° Last 500</button>
            <button class="btn-full" id="btnFull">üê¢ Deep (5k)</button>
            <button id="btnHistory" class="btn-hist">üîÆ Time Machine</button>
        </div>
        
        <div id="status"></div>

        <div id="dashboard" class="dashboard-grid">
            <div class="stat-card">
                <div class="stat-title t-buy">BUY SUMMARY</div>
                <div class="stat-line"><span>Tokens:</span> <strong id="buyTokens">0</strong></div>
                <div class="stat-line"><span>Cost (Hist):</span> <strong id="buyHist" class="val-hist">---</strong></div>
                <div class="stat-line"><span>Value (Now):</span> <strong id="buyCurr" class="val-curr">$0.00</strong></div>
            </div>
            <div class="stat-card">
                <div class="stat-title t-sell">SELL SUMMARY</div>
                <div class="stat-line"><span>Tokens:</span> <strong id="sellTokens">0</strong></div>
                <div class="stat-line"><span>Realized (Hist):</span> <strong id="sellHist" class="val-hist">---</strong></div>
                <div class="stat-line"><span>Value (Now):</span> <strong id="sellCurr" class="val-curr">$0.00</strong></div>
            </div>
            <div class="stat-card">
                <div class="stat-title t-receive">RECEIVE (IN)</div>
                <div class="stat-line"><span>Tokens:</span> <strong id="recvTokens">0</strong></div>
                <div class="stat-line"><span>Value (Hist):</span> <strong id="recvHist" class="val-hist">---</strong></div>
            </div>
            <div class="stat-card">
                <div class="stat-title t-send">SEND (OUT)</div>
                <div class="stat-line"><span>Tokens:</span> <strong id="sendTokens">0</strong></div>
                <div class="stat-line"><span>Value (Hist):</span> <strong id="send
